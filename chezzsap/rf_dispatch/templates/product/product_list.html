{% extends "base.html" %} {% block content %}
<div class="container py-4">
  <!-- Back Button -->
  <div class="mb-4">
    <a href="{% url 'add_product' %}" class="btn btn-outline-secondary btn-sm shadow-sm"> <i class="fa-solid fa-arrow-left me-2"></i> F7 BACK </a>
  </div>

  <!-- AJAX content wrapper -->
  <div id="product-list-container">
    <!-- Product Grid -->
    <div class="row g-4">
      {% for product in products %}
      <div class="col-md-4 col-sm-6">
        <div class="card shadow-sm border-0 rounded-4 h-100 product-card">
          <a href="{% url 'product_detail' product.product_id %}" class="text-decoration-none text-dark">
            {% if product.images %}
            <img src="{{ product.images.url }}" alt="{{ product.name }}" class="card-img-top img-fluid rounded-top product-img" />
            {% else %}
            <div class="d-flex justify-content-center align-items-center bg-light rounded-top" style="height: 180px">
              <i class="fa-solid fa-box-open fa-3x text-muted"></i>
            </div>
            {% endif %}
            <div class="card-body">
              <h5 class="card-title fw-bold text-primary"><i class="fa-solid fa-tag me-2"></i>{{ product.name }}</h5>
              <p class="card-text text-muted small"><i class="fa-solid fa-barcode me-2"></i>{{ product.sku }}</p>
              <p class="mb-1">
                <i class="fa-solid fa-boxes-stacked me-2 text-warning"></i>
                Qty: <strong>{{ product.quantity }}</strong>
              </p>
              <p class="mb-0">
                <i class="fa-solid fa-dollar-sign me-2 text-success"></i>
                {{ product.unit_price }}
              </p>
            </div>
          </a>
          <div class="card-footer bg-light d-flex justify-content-between rounded-bottom-4">
            <a href="{% url 'product_detail' product.product_id %}" class="btn btn-sm btn-outline-primary shadow-sm">
              <i class="fa-solid fa-circle-info me-1"></i> View
            </a>
            <a href="{% url 'product_edit' product.product_id %}" class="btn btn-sm btn-outline-warning shadow-sm">
              <i class="fa-solid fa-pen-to-square me-1"></i> Edit
            </a>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12 text-center text-muted"><i class="fa-solid fa-circle-exclamation me-2"></i> No products found.</div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if products.has_other_pages %}
    <div class="d-flex justify-content-center mt-4">
      <nav aria-label="Page navigation">
        <ul class="pagination pagination-sm">
          {% if products.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ products.previous_page_number }}"><i class="fa-solid fa-angle-left"></i></a>
          </li>
          {% else %}
          <li class="page-item disabled">
            <span class="page-link"><i class="fa-solid fa-angle-left"></i></span>
          </li>
          {% endif %} {% for num in products.paginator.page_range %} {% if products.number == num %}
          <li class="page-item active"><span class="page-link">{{ num }}</span></li>
          {% elif num > products.number|add:'-3' and num < products.number|add:'3' %}
          <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
          {% endif %} {% endfor %} {% if products.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ products.next_page_number }}"><i class="fa-solid fa-angle-right"></i></a>
          </li>
          {% else %}
          <li class="page-item disabled">
            <span class="page-link"><i class="fa-solid fa-angle-right"></i></span>
          </li>
          {% endif %}
        </ul>
      </nav>
    </div>
    {% endif %}
  </div>

  <!-- Loading Spinner -->
  <div id="loading-spinner" class="text-center my-4 d-none">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
</div>

<!-- Styles -->
<style>
  .product-card {
    transition: transform 0.25s ease, box-shadow 0.25s ease;
    cursor: pointer;
  }
  .product-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
  }
  .product-img {
    max-height: 180px;
    object-fit: cover;
    transition: transform 0.3s ease;
  }
  .product-card:hover .product-img {
    transform: scale(1.05);
  }
</style>

<!-- AJAX Script -->
<script>
  document.addEventListener("click", function (e) {
    if (e.target.closest(".pagination a")) {
      e.preventDefault();
      const url = e.target.closest("a").getAttribute("href");

      // Show spinner
      document.getElementById("loading-spinner").classList.remove("d-none");
      document.getElementById("product-list-container").classList.add("d-none");

      fetch(url, { headers: { "X-Requested-With": "XMLHttpRequest" } })
        .then((response) => response.text())
        .then((html) => {
          // Extract only inner part of #product-list-container
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, "text/html");
          const newContent = doc.querySelector("#product-list-container").innerHTML;

          document.querySelector("#product-list-container").innerHTML = newContent;

          // Hide spinner, show content
          document.getElementById("loading-spinner").classList.add("d-none");
          document.getElementById("product-list-container").classList.remove("d-none");

          window.scrollTo({ top: 0, behavior: "smooth" });
        });
    }
  });
</script>
{% endblock %}
