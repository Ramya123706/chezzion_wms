<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% load static %} {% load custom_tags %}
    <title>{% block title %}{{ page_title }}{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}" />
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  </head>

  <body>
    <!-- Overlay -->
    <div class="overlay" onclick="toggleSidebar()"></div>

    <!-- Topbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm px-3 topbar">
      <div class="container-fluid">
        <!-- Logo -->
        <a class="navbar-brand d-flex align-items-center" href="{% url 'index' %}">
          <img src="https://chezzion.com/wp-content/themes/chezzion-2025/assets/images/logo.png" alt="navbar logo" class="me-2" />
        </a>

        <!-- Mobile Buttons: Search + User Image + Sidebar -->
        <div class="d-flex align-items-center d-lg-none">
          <!-- Search toggle button -->
          <button class="btn me-2" type="button" onclick="toggleMobileSearch()">
            <i class="fa-solid fa-magnifying-glass fa-lg"></i>
          </button>

          <!-- User Image Dropdown -->
          <li class="nav-item dropdown list-unstyled">
            <a class="nav-link dropdown-toggle p-0" href="#" id="userDropdownMobile" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              {% if user.profile.image %}
              <img src="{{ user.profile.image.url }}" alt="Profile Image" class="rounded-circle border" width="35" height="35" />
              {% else %}
              <i class="fa-solid fa-user-circle fa-lg"></i>
              {% endif %}
            </a>
            <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="userDropdownMobile">
              <li>
                <a class="dropdown-item" href="{% url 'profile_detail' %}"><i class="fa-solid fa-id-badge me-2"></i> Profile</a>
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <a class="dropdown-item" href="{% url 'logout' %}"><i class="fa-solid fa-right-from-bracket me-2"></i> Logout</a>
              </li>
            </ul>
          </li>

          <!-- Sidebar toggle button -->
          <button class="btn btn-secondary ms-2" type="button" onclick="toggleSidebar()">
            <i class="fa-solid fa-bars fa-lg"></i>
          </button>
        </div>

        <div class="collapse navbar-collapse" id="topbarMenu">
          <!-- Desktop Search Form -->
          <form id="desktopSearchForm" class="d-flex mx-auto my-2 my-lg-0" role="search" method="get" action="{% url 'search' %}">
            <input class="form-control me-2" type="search" placeholder="Search features..." name="q" aria-label="Search" required />
            <button class="btn btn-outline-primary d-flex align-items-center" type="submit">
              <i class="fa-solid fa-magnifying-glass me-1"></i> Search
            </button>
          </form>

          <!-- Desktop User Dropdown -->
          <ul class="navbar-nav ms-auto d-none d-lg-flex">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle d-flex align-items-center"
                href="#"
                id="userDropdownDesktop"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false">
                {% if user.profile.image %}
                <img src="{{ user.profile.image.url }}" alt="Profile Image" class="rounded-circle me-2 border" width="30" height="30" />
                {% else %}
                <i class="fa-solid fa-user-circle fa-lg me-2"></i>
                {% endif %} {{ user.username }}
              </a>
              <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="userDropdownDesktop">
                <li>
                  <a class="dropdown-item" href="{% url 'profile_detail' %}"><i class="fa-solid fa-id-badge me-2"></i> Profile</a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="{% url 'logout' %}"><i class="fa-solid fa-right-from-bracket me-2"></i> Logout</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <!-- General -->
      <div class="nav-header">General</div>
      <a href="{% url 'home' %}" class="{% if request.path == '/home/' %}active{% endif %}"> <i class="fa-solid fa-house me-2"></i> Dashboard </a>

      <!-- Warehouse -->
      <div class="nav-header">Warehouse</div>
      <a href="#warehouseMenu" data-bs-toggle="collapse">
        <i class="fa-solid fa-warehouse me-2"></i> Warehouse <i class="fa-solid fa-angle-down float-end"></i>
      </a>
      <div
        class="collapse ps-3 {% if '/warehouse/' in request.path or '/inventory/' in request.path or '/create_bin/' in request.path or '/stocks/' in request.path or '/create_pallet/' in request.path %}show{% endif %}"
        id="warehouseMenu">
        <a href="{% url 'warehouse_view' %}" class="{% if request.path == '/warehouse/' %}active{% endif %}">
          <i class="fa-solid fa-building me-1"></i> Warehouses
        </a>
        <a href="{% url 'inventory' %}" class="{% if request.path == '/inventory/' %}active{% endif %}">
          <i class="fa-solid fa-boxes-stacked me-1"></i> Inventory
        </a>
        <a href="{% url 'create_bin' %}" class="{% if request.path == '/create_bin/' %}active{% endif %}">
          <i class="fa-solid fa-cube me-1"></i> Bins
        </a>
        <a href="{% url 'stock_list' %}" class="{% if request.path == '/stocks/' %}active{% endif %}">
          <i class="fa-solid fa-layer-group me-1"></i> Stock
        </a>
        <a href="{% url 'creating_pallet' %}" class="{% if request.path == '/create_pallet/' %}active{% endif %}">
          <i class="fa-solid fa-pallet me-1"></i> Pallets
        </a>
      </div>

      <!-- Orders -->
      <div class="nav-header">Orders</div>
      <a href="#ordersMenu" data-bs-toggle="collapse">
        <i class="fa-solid fa-file-invoice me-2"></i> Orders <i class="fa-solid fa-angle-down float-end"></i>
      </a>
      <div
        class="collapse ps-3 {% if '/purchases/' in request.path or '/sales/' in request.path or '/outbound-list/' in request.path or '/inbound_delivery/' in request.path or '/packing/' in request.path or '/pgi/' in request.path or '/gr_list/' in request.path or '/sorting/' in request.path or '/create-shipment/' in request.path %}show{% endif %}"
        id="ordersMenu">
        <a href="{% url 'purchase_list' %}" class="{% if request.path == '/purchases/' %}active{% endif %}">Purchases</a>
        <a href="{% url 'sales_order_list' %}" class="{% if request.path == '/sales/' %}active{% endif %}">Sales</a>
        <a href="{% url 'outbound_list' %}" class="{% if request.path == '/outbound-list/' %}active{% endif %}">Outbound</a>
        <a href="{% url 'inbound_delivery' %}" class="{% if request.path == '/inbound_delivery/' %}active{% endif %}">Inbound</a>
        <a href="{% url 'packing_list' %}" class="{% if request.path == '/packing/' %}active{% endif %}">Packing</a>
        <a href="{% url 'pgi_list' %}" class="{% if request.path == '/pgi/' %}active{% endif %}">PGI</a>
        <a href="{% url 'gr_list' %}" class="{% if request.path == '/gr_list/' %}active{% endif %}">GR</a>
        <a href="{% url 'sorting_list' %}" class="{% if request.path == '/sorting/' %}active{% endif %}">Sorting</a>
        <a href="{% url 'shipment_dashboard' %}" class="{% if request.path == '/create-shipment/' %}active{% endif %}">Shipments</a>
      </div>

      <!-- Masters -->
      <div class="nav-header">Masters</div>
      <a href="#mastersMenu" data-bs-toggle="collapse">
        <i class="fa-solid fa-cubes me-2"></i> Masters <i class="fa-solid fa-angle-down float-end"></i>
      </a>
      <div
        class="collapse ps-3 {% if '/product-list/' in request.path or '/customers/' in request.path or '/vendors/' in request.path or '/list_category/' in request.path or '/materials/' in request.path %}show{% endif %}"
        id="mastersMenu">
        <a href="{% url 'product_list' %}" class="{% if request.path == '/product-list/' %}active{% endif %}">
          <i class="fa-solid fa-box me-1"></i> Products
        </a>
        <a href="{% url 'customers_list' %}" class="{% if request.path == '/customers/' %}active{% endif %}">
          <i class="fa-solid fa-user-group me-1"></i> Customers
        </a>
        <a href="{% url 'vendor_list' %}" class="{% if request.path == '/vendors/' %}active{% endif %}">
          <i class="fa-solid fa-truck-fast me-1"></i> Vendors
        </a>
        <a href="{% url 'category_list' %}" class="{% if request.path == '/list_category/' %}active{% endif %}">
          <i class="fa-solid fa-tags me-1"></i> Categories
        </a>
        <a href="{% url 'material_list' %}" class="{% if request.path == '/materials/' %}active{% endif %}">
          <i class="fa-solid fa-layer-group me-1"></i> Materials
        </a>
      </div>

      <!-- Inspection & Trucks -->
      <div class="nav-header">Inspection & Trucks</div>
      <a href="#inspectionMenu" data-bs-toggle="collapse">
        <i class="fa-solid fa-truck me-2"></i> Inspection <i class="fa-solid fa-angle-down float-end"></i>
      </a>
      <div
        class="collapse ps-3 {% if '/yard_checkin/' in request.path or '/inspection/' in request.path or '/trucks/' in request.path or '/truck-status/' in request.path %}show{% endif %}"
        id="inspectionMenu">
        <a href="{% url 'yard_checkin' %}" class="{% if request.path == '/yard_checkin/' %}active{% endif %}">Yard Check-in</a>
        <a href="{% url 'truck_list' %}" class="{% if request.path == '/trucks/' %}active{% endif %}">Truck List</a>
        <a href="{% url 'add_questions' %}" class="{% if request.path == '/add-questions/' %}active{% endif %}">Inspection Questions</a>
      </div>

      <!-- Tasks & Operations -->
      <div class="nav-header">Tasks</div>
      <a href="#tasksMenu" data-bs-toggle="collapse">
        <i class="fa-solid fa-list-check me-2"></i> Tasks <i class="fa-solid fa-angle-down float-end"></i>
      </a>
      <div
        class="collapse ps-3 {% if '/task/' in request.path or '/picking/' in request.path or '/putaway/' in request.path or '/stock_upload/' in request.path or '/bulk-upload-' in request.path %}show{% endif %}"
        id="tasksMenu">
        <a href="{% url 'task' %}" class="{% if request.path == '/task/' %}active{% endif %}">All Tasks</a>
        <a href="{% url 'pending_task' %}" class="{% if request.path == '/pending_task/' %}active{% endif %}">Picking Tasks</a>
        <a href="{% url 'putaway_task' %}" class="{% if request.path == '/putaway_task/' %}active{% endif %}">Putaway Tasks</a>
        <a href="{% url 'stock_upload_login' %}" class="{% if request.path == '/stock_upload/login' %}active{% endif %}">Stock Upload</a>
        <a href="{% url 'bulk_upload_bins' %}" class="{% if request.path == '/bulk-upload-bins/' %}active{% endif %}">Bulk Upload Bins</a>
        <a href="{% url 'bulk_upload_products' %}" class="{% if request.path == '/bulk-upload-products/' %}active{% endif %}">Bulk Upload Products</a>
      </div>

      <!-- Admin -->
      <div class="nav-header">Admin</div>
      <a href="#adminMenu" data-bs-toggle="collapse">
        <i class="fa-solid fa-user-gear me-2"></i> Admin <i class="fa-solid fa-angle-down float-end"></i>
      </a>
      <div
        class="collapse ps-3 {% if '/users/' in request.path or '/profile_detail/' in request.path or '/accounts/superadmin/dashboard/' in request.path %}show{% endif %}"
        id="adminMenu">
        <a href="{% url 'user_list' %}" class="{% if request.path == '/users/' %}active{% endif %}"> <i class="fa-solid fa-users me-1"></i> Users </a>
        <a href="{% url 'profile_detail' %}" class="{% if request.path == '/profile_detail/' %}active{% endif %}">
          <i class="fa-solid fa-id-badge me-1"></i> My Profile
        </a>
        <a href="{% url 'superadmin_dashboard' %}" class="{% if request.path == '/accounts/superadmin/dashboard/' %}active{% endif %}">
          <i class="fa-solid fa-shield-halved me-1"></i> Superadmin
        </a>
        <a href="{% url 'logout' %}"> <i class="fa-solid fa-right-from-bracket me-1"></i> Logout </a>
      </div>

      <!-- Authentication -->
      <div class="nav-header">Authentication</div>
      <a href="#authMenu" data-bs-toggle="collapse"> <i class="fa-solid fa-lock me-2"></i> Auth <i class="fa-solid fa-angle-down float-end"></i> </a>
      <div class="collapse ps-3 {% if '/password_' in request.path or '/reset/' in request.path %}show{% endif %}" id="authMenu">
        <a href="{% url 'password_change' %}">Change Password</a>
        <a href="{% url 'password_reset' %}">Reset Password</a>
      </div>
    </div>

    <!-- Content -->
    <div class="content">
      <div class="container">
        {% if messages %} {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          <i class="fas fa-info-circle me-2"></i>{{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %} {% endif %} {% if form.errors %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <strong>Please fix the following errors:</strong>
          <ul class="mb-0">
            {% for field, errors in form.errors.items %} {% for error in errors %}
            <li><strong>{{ field|capfirst }}:</strong> {{ error }}</li>
            {% endfor %} {% endfor %}
          </ul>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}
      </div>
      {% block content %} {% endblock %}
    </div>

    <!-- JS -->
    <script src="{% static 'assets/js/jquery.min.js' %}"></script>
    <script src="{% static 'assets/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'assets/js/main.js' %}"></script>
    <script>
      function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("active");
        document.querySelector(".overlay").classList.toggle("active");
      }

      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("{% static 'sw.js' %}")
          .then(function (registration) {
            console.log("Service Worker Registered");
          })
          .catch(function (error) {
            console.log("Service Worker registration failed:", error);
          });
      }
    </script>
  </body>
</html>
