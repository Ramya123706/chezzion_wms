{% extends "base.html" %} {% block content %}
<div class="container py-5">
  <div class="card mx-auto shadow-lg p-4" style="max-width: 1000px">
    <!-- Header -->
    <div class="card-header bg-success text-white text-center">
      <h5>Post Goods Issue ({{ pgi.pgi_no }})</h5>
    </div>

    <!-- PGI Header Info -->
    <table class="table table-bordered mb-4">
      <tbody>
        <tr>
          <th>Delivery No</th>
          <td>{{ pgi.delivery.dlv_no }}</td>
        </tr>
        <tr>
          <th>Sales Order</th>
          <td>{{ pgi.delivery.so_no }}</td>
        </tr>
        <tr>
          <th>Warehouse</th>
          <td>{{ pgi.delivery.whs_no }}</td>
        </tr>
        <tr>
          <th>Customer</th>
          <td>{{ pgi.delivery.sold_to }}</td>
        </tr>
        <tr>
          <th>Posting Date</th>
          <td>{{ pgi.posting_date }}</td>
        </tr>
        <tr>
          <th>Posted By</th>
          <td>{{ pgi.posted_by }}</td>
        </tr>
        <tr>
          <th>Remarks</th>
          <td>{{ pgi.remarks|default:"-" }}</td>
        </tr>
      </tbody>
    </table>

    <!-- Line Items -->
    <h6 class="mt-3">Posted Items</h6>
    <div class="table-responsive">
      <table class="table table-bordered table-striped align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Item No</th>
            <th>Product</th>
            <th>Qty Ordered</th>
            <th>Qty Issued</th>
            <th>Unit Price</th>
            <th>Total Price</th>
            <th>Net Price</th>
            <th>Volume/Item</th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr>
            <td>{{ item.dlv_it_no }}</td>
            <td>{{ item.product_name }}</td>
            <td>{{ item.qty_order }}</td>
            <td>
              {{ item.qty_issued }} {% if item.low_stock %}
              <small class="text-warning">(Only {{ item.current_qty }} in stock)</small>
              {% endif %}
            </td>
            <td>{{ item.unit_price }}</td>
            <td>{{ item.unit_total_price }}</td>
            <td>{{ item.net_total_price }}</td>
            <td>{{ item.vol_per_item }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="8" class="text-center">No items found for this PGI</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Buttons -->
    <div class="text-center mt-4">
      <a href="{% url 'outbound_detail' delivery_no=pgi.delivery.dlv_no %}" class="btn btn-secondary me-2">
        <i class="fas fa-arrow-left"></i> Back to Delivery
      </a>
      <a href="{% url 'pgi_list' %}" class="btn btn-primary"> <i class="fas fa-list"></i> All PGIs </a>
    </div>
  </div>
</div>
{% endblock %}
