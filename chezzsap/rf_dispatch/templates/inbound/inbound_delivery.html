{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <h3 class="text-white bg-primary text-center mb-3">Inbound Delivery Form</h3>
            <form method="post">
                {% csrf_token %}
                {% if form.errors %}
                <div class="alert alert-danger">
                    {{ form.errors }}
                </div>
                {% endif %}
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="inbound_delivery_number"><b>Inbound Delivery Number</b></label>
                        <input type="text" class="form-control" name="inbound_delivery_number"
                            id="inbound_delivery_number" value="{{ delivery.inbound_delivery_number }}"
                            placeholder="Auto generated" readonly>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="delivery_date"><b>Delivery Date</b></label>
                        <input type="date" class="form-control" name="delivery_date" id="delivery_date"
                            value="{{ delivery.delivery_date }}">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="vendor" class="form-label"><b>Supplier (Vendor)</b></label>
                        <select name="vendor" id="vendor" class="form-select">
                            <option value=""> Select Supplier </option>
                            {% for vendor in vendors %}
                            <option value="{{ vendor.vendor_id }}">{{ vendor.vendor_id }}-{{ vendor.name }}</option>
                            {% endfor %}
                        </select>


                    </div>



                    <div class="col-md-6 mb-3">
                        <label for="purchase_order" class="form-label"><b>PO No</b></label>
                        <select name="po_number" id="purchase_order" class="form-select">
                            <option value="">Select PO No </option>
                            {% for po in purchase_orders %}
                            <option value="{{ po.id }}">{{ po.po_number }}</option>
                            {% endfor %}
                        </select>

                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="esn"><b>ESN</b></label>
                        <input type="text" class="form-control" name="esn" id="esn" value="{{ delivery.esn }}">
                    </div>


<div class="col-md-6 mb-3">
    <label for="whs_no" class="form-label"><b>Warehouse</b></label>
    <select name="whs_no" id="whs_no" class="form-select" required>
        <option value="">Select a warehouse</option>
        {% for wh in warehouses %}
            <option value="{{ wh.pk }}">{{ wh.whs_no }} - {{ wh.whs_name }}</option>
        {% endfor %}
    </select>
</div>



                    <div class="col-md-6 mb-3">
                        <label for="document_date"><b>Document Date</b></label>
                        <input type="date" class="form-control" name="document_date" id="document_date"
                            value="{{ delivery.document_date }}">
                    </div>

                    

                    <div class="col-md-6 mb-3">
                          <label for="delivery_status"><b>Delivery Status</b></label>
                        <select class="form-control" name="delivery_status" id="delivery_status">
                            <option value="" disabled selected>Select status</option>
                            <option value="Pending">
                                Pending</option>
                            <option value="Completed">
                                Completed</option>
                        </select>
                    </div>

                   

                    <!-- Material Table -->
                    <table class="table table-bordered" id="deliveryTable">
                        <thead class="table-light">
                            <tr>
                                <th>Product</th>
                                <th>Product Description</th>
                                <th>Quantity Delivered</th>
                                <th>Quantity Received</th>
                                <th>Unit of Measure</th>
                                <th>Batch Number</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" class="form-control" name="product[]"></td>
                                <td><input type="text" class="form-control" name="product_description[]"></td>
                                <td><input type="text" class="form-control" name="quantity_delivered[]"></td>
                                <td><input type="text" class="form-control" name="quantity_received[]"></td>
                                <td><input type="text" class="form-control" name="unit_of_measure[]"></td>
                                <td><input type="text" class="form-control" name="batch_number[]"
                                        placeholder="Auto generated" readonly></td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Remarks -->
                    <div class="col-md-12 mb-3">
                        <label for="remarks"><b>Remarks</b></label>
                        <textarea class="form-control" name="remarks" id="remarks">{{ delivery.remarks }}</textarea>
                    </div>

                    <div class="text-center">
                        <button type="submit" class="btn btn-primary px-5 mt-3">Submit</button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Sidebar -->
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-header bg-primary text-white text-center">
                    <h4 class="mb-0">Search Inbound Deliveries</h4>
                </div>
                <div class="card-body">
                    <form method="get" class="mb-3">
                        <div class="input-group">
                            <input type="text" name="ibd_no" class="form-control" placeholder="Search by IBD No."
                                value="{{ request.GET.inbound_delivery_number}}">
                            <button class="btn btn-primary" type="submit">Search</button>
                        </div>
                    </form>

                    {% if deliveries %}
                    <table class="table table-sm table-bordered">
                        <thead class="thead-light">
                            <tr>
                                <th>Date</th>
                                <th>IBD No.</th>
                                <th>PO No.</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for entry in deliveries %}
                            <tr>
                                <td>{{ entry.delivery_date }}</td>
                                <td>{{ entry.inbound_delivery_number }}</td>
                                <td>{{ entry.purchase_order_number.po_number }}</td>
                                <td>
                                    <a href="{% url 'delivery_detail' entry.inbound_delivery_number %}"
                                        class="btn btn-sm btn-info px-3 py-1 fs-6">View Details</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <div class="alert alert-warning text-center">No deliveries found.</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 
<script>
    // Function to add a new row to the table
    function addRow() {
        const tableBody = document.querySelector('#deliveryTable tbody');
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td><input type="text" class="form-control" name="material_code[]"></td>
            <td><input type="text" class="form-control" name="material_description[]"></td>
            <td><input type="text" class="form-control" name="quantity_delivered[]"></td>
            <td><input type="text" class="form-control" name="quantity_received[]"></td>
            <td><input type="text" class="form-control" name="unit_of_measure[]"></td>
            <td><input type="text" class="form-control" name="batch_number[]" placeholder="Auto-generated" readonly></td>
        `;
        tableBody.appendChild(newRow);
    }

    // Set placeholder for first row on page load
    document.addEventListener("DOMContentLoaded", function () {
        let firstBatchInput = document.querySelector('#deliveryTable tbody tr td:last-child input');
        if (firstBatchInput) {
            firstBatchInput.placeholder = "Auto-generated";
        }
    });
</script> -->
<!-- <script>
document.getElementById("purchase_order").addEventListener("change", function() {
    const poId = this.value;
    const tableBody = document.querySelector('#deliveryTable tbody');
    tableBody.innerHTML = "";  // clear previous rows

    if (poId) {
        fetch(`/get-po-products/${poId}/`)
            .then(response => response.json())
            .then(data => {
                data.products.forEach(p => {
                    const newRow = document.createElement("tr");
                    newRow.innerHTML = `

                        <td><input type="text" class="form-control" name="product[]" value="${p.code}" readonly></td>
                        <td><input type="text" class="form-control" name="product_description[]" value="${p.description}" readonly></td>
                        <td><input type="text" class="form-control" name="quantity_delivered[]" value="${p.quantity}" readonly></td>
                        <td><input type="text" class="form-control" name="quantity_received[]" ></td>
                        <td><input type="text" class="form-control" name="unit_of_measure[]" value="${p.uom}" readonly></td>
                        <td><input type="text" class="form-control" name="batch_number[]" placeholder="Auto generated" readonly></td>
                    `;
                        tableBody.appendChild(newRow);
                    });
                });
            });
    }
});
</script> -->


{% endblock %}