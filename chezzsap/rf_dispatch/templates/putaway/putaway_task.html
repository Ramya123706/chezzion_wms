{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
  <div class="col-md-8 col-sm-12 mx-auto">
    <div class="card">
      <div class="card-header text-center text-white bg-primary">
        <h3>Putaway Task</h3>
      </div>
      <div class="card-body">
        <ul class="nav nav-tabs" id="putawayTabs" role="tablist">
          <li class="nav-item">
            <button class="nav-link active" id="hu-tab" data-bs-toggle="tab" data-bs-target="#hu" type="button">By HU</button>
          </li>
          <li class="nav-item">
            <button class="nav-link" id="warehouse-tab" data-bs-toggle="tab" data-bs-target="#warehouse" type="button">By Warehouse</button>
          </li>
          <li class="nav-item">
            <button class="nav-link" id="product-tab" data-bs-toggle="tab" data-bs-target="#product" type="button">By Product</button>
          </li>
          <li class="nav-item">
            <button class="nav-link" id="bin-tab" data-bs-toggle="tab" data-bs-target="#bin" type="button">By Bin</button>
          </li>
        </ul>

        <div class="tab-content mt-3">

          <!-- By HU -->
          <div class="tab-pane fade show active" id="hu">
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="putaway_task_type" value="Putaway by HU" />

              <div class="mb-3">
                <label><b>Pallet (HU)</b></label>
                <select id="pallet_select" name="pallet" class="form-select" required>
                  <option value="">--Select Pallet--</option>
                  {% for p in pallets %}
                  <option value="{{ p.id }}">{{ p.pallet_no }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="mb-3">
                <label><b>Source Location</b></label>
                <input type="text" id="hu_source_location" name="source_location" class="form-control" required readonly />
              </div>

              <div class="mb-3">
                <label><b>Destination Location</b></label>
                <input type="text" name="destination_location" class="form-control" required />
              </div>

              <div class="mb-3">
                <label><b>Status</b></label>
                <select name="status" class="form-select">
                  <option value="In Progress">In Progress</option>
                  <option value="Completed">Completed</option>
                </select>
              </div>

              <input type="hidden" name="putaway_id" value="{{ putaway_id }}" />
              <button type="submit" class="btn btn-primary">Submit HU</button>
            </form>
          </div>

          <!-- By Warehouse -->
          <div class="tab-pane fade" id="warehouse">
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="putaway_task_type" value="Putaway by Warehouse" />

              <div class="mb-3">
                <label><b>Warehouse</b></label>
                <select id="warehouse_select" name="whs_no" class="form-select" required>
                  <option value="">--Select Warehouse--</option>
                  {% for wh in warehouses %}
                  <option value="{{ wh.whs_no }}">{{ wh.whs_no }} - {{ wh.whs_name }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="mb-3">
                <label><b>Source Location</b></label>
                <input type="text" id="warehouse_source_location" name="source_location" class="form-control" required readonly />
              </div>

              <div class="mb-3">
                <label><b>Destination Location</b></label>
                <input type="text" name="destination_location" class="form-control" required />
              </div>

              <div class="mb-3">
                <label><b>Status</b></label>
                <select name="status" class="form-select">
                  <option value="In Progress">In Progress</option>
                  <option value="Completed">Completed</option>
                </select>
              </div>

              <input type="hidden" name="putaway_id" value="{{ putaway_id }}" />
              <button type="submit" class="btn btn-primary">Submit Warehouse</button>
            </form>
          </div>

          <!-- By Product -->
          <div class="tab-pane fade" id="product">
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="putaway_task_type" value="Putaway by Product" />

              <div class="mb-3">
                <label><b>Product</b></label>
                <select id="product_select" name="product" class="form-select" required>
                  <option value="">--Select Product--</option>
                  {% for prod in products %}
                  <option value="{{ prod.product_id }}">{{ prod.name }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="mb-3">
                <label><b>Source Location</b></label>
                <input type="text" id="product_source_location" name="source_location" class="form-control" required readonly />
              </div>

              <div class="mb-3">
                <label><b>Destination Location</b></label>
                <input type="text" name="destination_location" class="form-control" required />
              </div>

              <div class="mb-3">
                <label><b>Status</b></label>
                <select name="status" class="form-select">
                  <option value="In Progress">In Progress</option>
                  <option value="Completed">Completed</option>
                </select>
              </div>

              <input type="hidden" name="putaway_id" value="{{ putaway_id }}" />
              <button type="submit" class="btn btn-primary">Submit Product</button>
            </form>
          </div>

          <!-- By Bin -->
          <div class="tab-pane fade" id="bin">
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="putaway_task_type" value="Putaway by Bin" />

              <div class="mb-3">
                <label><b>Bin</b></label>
                <select id="bin_select" name="bin" class="form-select" required>
                  <option value="">--Select Bin--</option>
                  {% for b in bins %}
                  <option value="{{ b.id }}">{{ b.bin_type }}-{{ b.bin_id }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="mb-3">
                <label><b>Source Location</b></label>
                <input type="text" id="bin_source_location" name="source_location" class="form-control" required readonly />
              </div>

              <div class="mb-3">
                <label><b>Destination Location</b></label>
                <input type="text" name="destination_location" class="form-control" required />
              </div>

              <div class="mb-3">
                <label><b>Status</b></label>
                <select name="status" class="form-select">
                  <option value="In Progress">In Progress</option>
                  <option value="Completed">Completed</option>
                </select>
              </div>

              <input type="hidden" name="putaway_id" value="{{ putaway_id }}" />
              <button type="submit" class="btn btn-primary">Submit Bin</button>
            </form>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

    // HU (Pallet)
    const palletSelect = document.getElementById("pallet_select");
    const huSource = document.getElementById("hu_source_location");
    palletSelect?.addEventListener("change", function() {
        const id = this.value;
        if(id){
            fetch(`/get-pallet-location/${id}/`)
            .then(res => res.json())
            .then(data => huSource.value = data.location || "No location set")
            .catch(err => huSource.value = "");
        } else { huSource.value = ""; }
    });

    // Warehouse
    const warehouseSelect = document.getElementById("warehouse_select");
    const warehouseSource = document.getElementById("warehouse_source_location");
    warehouseSelect?.addEventListener("change", function() {
        const id = this.value;
        if(id){
            fetch(`/get-warehouse-location/${id}/`)
            .then(res => res.json())
            .then(data => warehouseSource.value = data.location || "No location set")
            .catch(err => warehouseSource.value = "");
        } else { warehouseSource.value = ""; }
    });

    // Product
    const productSelect = document.getElementById("product_select");
    const productSource = document.getElementById("product_source_location");
    productSelect?.addEventListener("change", function() {
        const id = this.value;
        if(id){
            fetch(`/get-product-location/${id}/`)
            .then(res => res.json())
            .then(data => productSource.value = data.location || "No location set")
            .catch(err => productSource.value = "");
        } else { productSource.value = ""; }
    });

    // Bin
    const binSelect = document.getElementById("bin_select");
    const binSource = document.getElementById("bin_source_location");
    binSelect?.addEventListener("change", function() {
        const id = this.value;
        if(id){
            fetch(`/get-bin-location/${id}/`)
            .then(res => res.json())
            .then(data => binSource.value = data.location || "No location set")
            .catch(err => binSource.value = "");
        } else { binSource.value = ""; }
    });

});
</script>

{% endblock %}
