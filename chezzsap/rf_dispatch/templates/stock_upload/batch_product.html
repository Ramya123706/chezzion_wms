{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <div class="col-md-6 col-sm-12 mx-auto">
        <div class="card">
            <div class="card-header">
                <h5>Chezzion WMS-Magic Box</h5>
            </div>
            <div class="card-body">
                <div class="mb-3 text-center">
                    <img src="https://chezzion.com/wp-content/themes/chezzion-2025/assets/images/logo.png" width="50" alt="SAP logo">
                </div>

                {% if success %}
                    <div class="alert alert-success">✅ Stock uploaded successfully!</div>
                {% endif %}

                {% if error %}
                    <div class="alert alert-danger">❌ {{ error }}</div>
                {% endif %}

                <form action="{% url 'batch_product' %}" method="post">
                    {% csrf_token %}

                    <!-- Warehouse -->
                    <div class="form-group">
                        <label><b>Warehouse</b></label>
                        <select name="whs_no" class="form-control" required>
                            <option value="">Select Warehouse</option>
                            {% for wh in warehouse %}
                                <option value="{{ wh.whs_no }}">{{ wh.whs_no }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Product Search -->
                    <div class="form-group position-relative">
                        <label for="product_input">Product</label>
                        <input type="text" class="form-control" id="product_input" name="product" placeholder="Start typing product ID or name" autocomplete="off" required>
                        <div id="product_suggestions" class="border bg-white position-absolute w-100" style="z-index: 1000; display: none;"></div>
                    </div>

                    <small class="form-text text-muted">
                        Can't find your product?
                        <a href="{% url 'add_product' %}" class="btn btn-sm btn-link">Add New Product</a>
                    </small>

                    <!-- Category -->
                    <div class="form-group">
                        <label for="category">Category</label>
                        <input type="text" class="form-control" id="category" name="category" required>
                    </div>

                    <!-- Description -->
                    <div class="form-group">
                        <label for="description">Description</label>
                        <input type="text" class="form-control" id="description" name="description" required>
                    </div>

                    <!-- Quantity -->
                    <div class="form-group">
                        <label for="quantity">Quantity</label>
                        <input type="number" class="form-control" id="quantity" name="quantity" required>
                    </div>

                    <!-- Batch -->
                    <div class="form-group">
                        <label for="batch">Batch</label>
                        <input type="text" class="form-control" id="batch" name="batch" required>
                    </div>

                    <!-- BIN -->
                    <div class="form-group">
                        <label for="bin">BIN</label>
                        <input type="text" class="form-control" id="bin" name="bin" required>
                    </div>

                    <!-- Pallet -->
                    <div class="form-group">
                        <label for="pallet">Pallet</label>
                        <input type="text" class="form-control" id="pallet" name="pallet" required>
                    </div>

                    <!-- P_mat -->
                    <div class="form-group">
                        <label for="p_mat">P_mat</label>
                        <input type="text" class="form-control" id="p_mat" name="p_mat" required>
                    </div>

                    <!-- Inspection -->
                    <div class="form-group">
                        <label for="inspection">Inspection</label>
                        <input type="text" class="form-control" id="inspection" name="inspection" required>
                    </div>

                    <!-- Stock Type -->
                    <div class="form-group">
                        <label for="stock_type">Stock Type</label>
                        <select class="form-control" id="stock_type" name="stock_type" required>
                            <option value="">-- Select Stock Type --</option>
                            <option value="Quality">Quality</option>
                            <option value="Blocked">Blocked</option>
                            <option value="Scrapped">Scrapped</option>
                            <option value="Unrestricted">Unrestricted</option>
                        </select>
                    </div>

                    <!-- WPS -->
                    <div class="form-group">
                        <label for="wps">WPS</label>
                        <input type="text" class="form-control" id="wps" name="wps" required>
                    </div>

                    <!-- Doc No -->
                    <div class="form-group">
                        <label for="doc_no">Doc No</label>
                        <input type="text" class="form-control" id="doc_no" name="doc_no" required>
                    </div>

                    <!-- Pallet Status -->
                    <div class="form-group">
                        <label for="pallet_status">Pallet Status</label>
                        <select class="form-control" id="pallet_status" name="pallet_status" required>
                            <option value="">-- Select Pallet Status --</option>
                            <option value="Received">Received</option>
                            <option value="Planned">Planned</option>
                            <option value="Damaged">Damaged</option>
                            <option value="Rejected">Rejected</option>
                        </select>
                    </div>

                    <!-- Buttons -->
                    <div class="d-flex justify-content-between mt-4">
                        <a class="btn btn-secondary" href="#">F1 ADIT</a>
                        <a class="btn btn-secondary" href="#">F1 SKUP</a>
                        <a class="btn btn-secondary" href="#">F7 BACK</a>
                        <button type="submit" class="btn btn-primary">ENTER</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById("product_input").addEventListener("keyup", function () {
    const query = this.value.trim();
    const suggestionBox = document.getElementById("product_suggestions");

    if (query.length > 0) {
        fetch(`/ajax/product-suggestions/?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                suggestionBox.innerHTML = "";
                if (data.results.length > 0) {
                    data.results.forEach(item => {
                        const div = document.createElement("div");
                        div.textContent = `${item.product_id} - ${item.name}`;
                        div.style.cursor = "pointer";
                        div.classList.add("p-2", "suggestion-item");

                        div.onclick = function () {
                            document.getElementById("product_input").value = item.product_id;
                            document.getElementById("description").value = item.description || "";
                            document.getElementById("category").value = item.category || "";
                            suggestionBox.style.display = "none";
                        };

                        suggestionBox.appendChild(div);
                    });
                    suggestionBox.style.display = "block";
                } else {
                    suggestionBox.style.display = "none";
                }
            })
            .catch(err => {
                console.error("Error fetching product suggestions:", err);
                suggestionBox.style.display = "none";
            });
    } else {
        suggestionBox.style.display = "none";
    }
});
</script>
{% endblock %}
